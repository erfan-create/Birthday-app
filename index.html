<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Natalia Birthday Surprise</title>
  <style>
    *{box-sizing:border-box}
    body { margin:0; font-family:sans-serif; background:#fff7fb; overflow-x:hidden; color:#2d0a1b; }
    .screen { display:none; height:100vh; width:100%; text-align:center; padding:16px; }
    .active { display:flex; flex-direction:column; justify-content:center; align-items:center; }
    button { padding:10px 20px; margin-top:20px; border:none; border-radius:12px; background:#e91e63; color:white; font-weight:700; cursor:pointer; box-shadow:0 6px 16px rgba(233,30,99,.25); }
    button:active{ transform: translateY(1px); }

    /* Intro fading text centered */
    .fade-text { font-size:clamp(22px,4vw,36px); opacity:0; transition: opacity 1.6s ease; position:absolute; text-align:center; width:100%; top:50%; transform:translateY(-50%); pointer-events:none; }

    /* Memory puzzle grid (fixed card size) */
    .grid { width:min(92vw, 640px); margin:12px auto 0; display:grid; grid-template-columns:repeat(4, 1fr); gap:12px; }
    @media (max-width: 680px){ .grid{ width:min(92vw,520px); grid-template-columns:repeat(3,1fr);} }
    @media (max-width: 460px){ .grid{ width:min(92vw,360px); grid-template-columns:repeat(2,1fr);} }
    .grid > .card3d { width:100%; aspect-ratio:1/1; perspective:1000px; cursor:pointer; }
    .card-inner { position:relative; width:100%; height:100%; transform-style:preserve-3d; transition: transform .5s; }
    .card3d.flipped .card-inner { transform: rotateY(180deg); }
    .face { position:absolute; inset:0; backface-visibility:hidden; border-radius:10px; overflow:hidden; display:flex; align-items:center; justify-content:center; border:1px solid rgba(0,0,0,.08); }
    .front { background:linear-gradient(180deg,#fff,#fff5f9); font-size:28px; color:#9e9e9e; }
    .back { transform: rotateY(180deg); background:#fff; }
    .back img { width:100%; height:100%; object-fit:cover; display:block; }

    /* Flower wall */
    .flower-wall { display:flex; flex-wrap:wrap; gap:8px; justify-content:center; padding:8px; }
    .flower-wall img { width:84px; height:84px; object-fit:cover; border-radius:10px; }

    /* Scrambled puzzle (clickable) */
    .word-bank, .answer-area { display:flex; flex-wrap:wrap; gap:10px; margin:10px; justify-content:center; }
    .word { background:#f8bbd0; padding:8px 12px; border-radius:999px; cursor:pointer; user-select:none; box-shadow:0 2px 6px rgba(0,0,0,.08); }
    .answer-area .word { background:#e1bee7; }

    /* Video modal */
    #videoModal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); justify-content:center; align-items:center; padding:16px; }
    #videoModal video { max-width:92vw; max-height:82vh; border-radius:12px; }

    /* Final */
    #final { background:#ffe4ec; color:#2d0a1b; font-size:clamp(22px,4vw,36px); position:relative; overflow:hidden; }
    #finalMessage { opacity:0; transition: opacity 2.6s ease; }

    /* Petals animation */
    .petal { position:absolute; width:18px; height:18px; background:radial-gradient(circle at 30% 30%, #ffc0cb, #ff8fb3); border-radius:50% 50% 50% 50%/60% 60% 40% 40%; opacity:0.75; animation: fall linear forwards; filter: blur(.2px); }
    @keyframes fall { from { transform: translateY(-10vh) rotate(0deg); opacity:.85; } to { transform: translateY(110vh) rotate(360deg); opacity:0; } }
  </style>
</head>
<body>

  <!-- Landing -->
  <section class="screen active" id="landing">
    <button id="landingStart">Start</button>
  </section>

  <!-- Intro -->
  <section class="screen" id="intro">
    <div id="introText" class="fade-text"></div>
    <button id="introBtn" style="display:none; position:relative; top:120px;">Start Puzzle</button>
  </section>

  <!-- Puzzle 1 -->
  <section class="screen" id="puzzle1">
    <h2>Find the matching flowers</h2>
    <div class="grid" id="memoryGrid"></div>
  </section>

  <!-- Flower wall -->
  <section class="screen" id="flowerWall">
    <h2>She is more beautiful than the most beautiful flowers in the world ðŸŒ¸</h2>
    <div class="flower-wall" id="flowerGallery"></div>
    <button id="toPuzzle2">Continue</button>
  </section>

  <!-- Puzzle 2 -->
  <section class="screen" id="puzzle2">
    <h2>Arrange the words in the correct order</h2>
    <div class="word-bank" id="wordBank"></div>
    <div class="answer-area" id="answerArea"></div>
    <button id="checkSentence">Check</button>
  </section>

  <!-- Message page -->
  <section class="screen" id="messagePage">
    <button id="showVideo">The message</button>
  </section>

  <!-- Video modal -->
  <div id="videoModal">
    <video id="messageVideo" controls>
      <source src="message-video.mp4" type="video/mp4">
    </video>
  </div>

  <!-- Final -->
  <section class="screen" id="final">
    <div id="finalMessage">Happy birthday Natalia â€“ 08.09.2025</div>
  </section>

  <!-- Background music -->
  <audio id="bgMusic" src="Audio.mp3" loop></audio>

  <script>
    const screens=["landing","intro","puzzle1","flowerWall","puzzle2","messagePage","final"];
    function go(id){ screens.forEach(s=>document.getElementById(s).classList.remove("active")); document.getElementById(id).classList.add("active"); }

    const bgMusic=document.getElementById("bgMusic");

    // Landing -> start music + intro
    document.getElementById("landingStart").addEventListener("click",()=>{
      try{ bgMusic.volume=0.6; bgMusic.play(); }catch(e){}
      go("intro");
      runIntro();
    });

    // Intro fading text (centered)
    const introLines=["Hello Natalia","this is","a small digital gift","for you","with love"];
    function runIntro(){
      let idx=0; const text=document.getElementById("introText");
      function nextLine(){
        if(idx<introLines.length){
          text.textContent=introLines[idx++];
          text.style.opacity=1;
          setTimeout(()=>{ text.style.opacity=0; setTimeout(nextLine,1000); }, 1600);
        } else {
          document.getElementById("introBtn").style.display="inline-block";
        }
      }
      nextLine();
    }
    document.getElementById("introBtn").addEventListener("click",()=>{ go("puzzle1"); buildDeck(); });

    // Puzzle 1 (memory) â€” deterministic deck size
    const flowerImages=["Frangipani1.jpg","Frangipani2.jpg","Peony1.jpg","Peony2.jpg","Pinkrose.jpg","White1.jpg"];
    const grid=document.getElementById("memoryGrid"); let first=null,lock=false,matched=0;
    function buildDeck(){
      const deck=[...flowerImages,...flowerImages].map((src,i)=>({id:i,src,key:src}));
      for(let i=deck.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [deck[i],deck[j]]=[deck[j],deck[i]]; }
      grid.innerHTML="";
      deck.forEach(c=>{
        const card=document.createElement('div'); card.className='card3d'; card.dataset.key=c.key;
        card.innerHTML=`<div class="card-inner"><div class="face front">ðŸŒ¸</div><div class="face back"><img src="${c.src}" alt="flower"></div></div>`;
        card.addEventListener('click',()=>flip(card));
        grid.appendChild(card);
      });
      first=null; lock=false; matched=0;
    }
    function flip(card){
      if(lock||card.classList.contains('flipped')) return; card.classList.add('flipped');
      if(!first){ first=card; return; }
      lock=true; const match = first.dataset.key===card.dataset.key;
      setTimeout(()=>{
        if(!match){ first.classList.remove('flipped'); card.classList.remove('flipped'); }
        else { matched++; if(matched===flowerImages.length){ showFlowerWall(); } }
        first=null; lock=false;
      },600);
    }

    // Flower wall
    function showFlowerWall(){
      go('flowerWall');
      const gal=document.getElementById('flowerGallery'); gal.innerHTML='';
      for(let i=0;i<140;i++){ const img=document.createElement('img'); img.src=flowerImages[i%flowerImages.length]; gal.appendChild(img); }
    }
    document.getElementById('toPuzzle2').addEventListener('click',()=> go('puzzle2'));

    // Puzzle 2 (clickable, fixed scrambled order)
    const sentence="The world became bright and colorful on this day when you opened your diamond eyes to the world";
    const words=sentence.split(' ');
    function seededShuffle(arr, seed=12345){
      const a=arr.slice(); let s=seed;
      for(let i=a.length-1;i>0;i--){ s=(s*9301+49297)%233280; const r=s/233280; const j=Math.floor(r*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
      return a;
    }
    const fixedScramble = seededShuffle(words, 723);
    const wordBank=document.getElementById('wordBank');
    const answerArea=document.getElementById('answerArea');
    function buildWords(){
      wordBank.innerHTML=''; answerArea.innerHTML='';
      fixedScramble.forEach(w=>{
        const btn=document.createElement('div'); btn.className='word'; btn.textContent=w;
        btn.addEventListener('click',()=>{ answerArea.appendChild(btn); });
        wordBank.appendChild(btn);
      });
    }
    buildWords();
    answerArea.addEventListener('click',e=>{ if(e.target.classList.contains('word')){ wordBank.appendChild(e.target); }});
    document.getElementById('checkSentence').addEventListener('click',()=>{
      const attempt=[...answerArea.querySelectorAll('.word')].map(w=>w.textContent).join(' ');
      if(attempt===sentence){ go('messagePage'); }
      else { alert('Not quite right, try again!'); }
    });

    // Video & music fade
    const modal=document.getElementById('videoModal');
    const video=document.getElementById('messageVideo');
    document.getElementById('showVideo').addEventListener('click',()=>{ modal.style.display='flex'; video.currentTime=0; video.play(); fadeVolume(0.08, 1600); });
    video.addEventListener('ended',()=>{ modal.style.display='none'; fadeVolume(0.6, 1600); showFinal(); });
    modal.addEventListener('click',e=>{ if(e.target===modal){ modal.style.display='none'; video.pause(); fadeVolume(0.6,1600); showFinal(); } });

    function fadeVolume(target, durationMs){
      const steps=12; const start=bgMusic.volume||0; let i=0; const delta=(target-start)/steps;
      const t=setInterval(()=>{ i++; bgMusic.volume=Math.max(0, Math.min(1, start + delta*i)); if(i>=steps) clearInterval(t); }, durationMs/steps);
    }

    // Final message + petals
    let petalsTimer=null, petalsStarted=false;
    function showFinal(){
      go('final');
      setTimeout(()=>{ document.getElementById('finalMessage').style.opacity=1; }, 400);
      if(!petalsStarted){ petalsStarted=true; spawnPetals(); petalsTimer=setInterval(spawnPetals, 3000); }
    }
    function spawnPetals(){
      const final=document.getElementById('final');
      for(let i=0;i<18;i++){
        const p=document.createElement('div'); p.className='petal';
        p.style.left = Math.random()*100 + 'vw';
        p.style.animationDuration = (6 + Math.random()*6) + 's';
        p.style.animationDelay = (Math.random()*1.5) + 's';
        final.appendChild(p);
        setTimeout(()=>p.remove(), 14000);
      }
    }
  </script>
</body>
</html>
